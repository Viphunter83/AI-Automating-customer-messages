# üìù –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –æ –º–∏–≥—Ä–∞—Ü–∏—è—Ö –ë–î

**–ü—Ä–æ–µ–∫—Ç:** Neiromatrius  
**–î–∞—Ç–∞:** 8 –¥–µ–∫–∞–±—Ä—è 2025

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é

**–î–ª—è Supabase self-hosted –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL Editor, –∞ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Alembic.**

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–π

### 1. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Supabase SQL Editor:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí **SQL Editor**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `database/migrations_supabase.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ **Run** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ ENUM —Ç–∏–ø–æ–≤

### 2. Backend entrypoint

**–í `backend/scripts/entrypoint.sh` –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic –æ—Ç–∫–ª—é—á–µ–Ω—ã:**

```bash
# –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
# alembic upgrade head
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ú–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Supabase SQL Editor
- Alembic –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º–æ–π
- –†—É—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–µ—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è

---

## üîß –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Alembic –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π:

1. **–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ `backend/scripts/entrypoint.sh`:**
   ```bash
   alembic upgrade head
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Alembic –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
   - `backend/migrations/alembic.ini` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
   - `DATABASE_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   - –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ `backend/migrations/versions/` –∞–∫—Ç—É–∞–ª—å–Ω—ã

3. **‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** Alembic –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ SQL –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥

**–î–ª—è Supabase self-hosted —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**

1. ‚úÖ –í—ã–ø–æ–ª–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL Editor
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `database/migrations_supabase.sql` –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. ‚úÖ –î–ª—è –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π —Å–æ–∑–¥–∞–≤–∞—Ç—å SQL —Ñ–∞–π–ª—ã –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Ä—É—á–Ω—É—é
4. ‚úÖ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Alembic, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN (
    'messages', 'classifications', 'response_templates', 
    'keywords', 'operator_feedback', 'operator_session_logs',
    'reminders', 'chat_sessions', 'operator_message_reads'
);

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ ENUM —Ç–∏–ø–æ–≤
SELECT typname 
FROM pg_type 
WHERE typtype = 'e' 
AND typname IN (
    'messagetype', 'scenariotype', 'remindertype', 
    'dialogstatus', 'prioritylevel', 'escalationreason'
);
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 8 –¥–µ–∫–∞–±—Ä—è 2025







