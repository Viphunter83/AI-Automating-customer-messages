# 📝 Как заполнить переменные окружения в Railway

**Дата:** 2025-11-27  
**Интерфейс:** Railway Variables

---

## 🎯 Что нужно добавить

Вам нужно добавить **3 обязательные переменные**:

1. **DATABASE_URL** - подключение к базе данных
2. **OPENAI_API_KEY** - ключ для AI
3. **SECRET_KEY** - секретный ключ безопасности

---

## 📋 Пошаговая инструкция

### Переменная 1: DATABASE_URL

#### Шаг 1: Получите значение из PostgreSQL сервиса

1. В Railway Dashboard вернитесь к списку сервисов
2. Откройте сервис **PostgreSQL** (отдельный сервис)
3. Variables → найдите `DATABASE_URL` или `POSTGRES_URL`
4. Скопируйте значение (например: `postgresql://postgres:password@host:5432/railway`)

#### Шаг 2: Измените формат

**ВАЖНО:** Нужно изменить `postgresql://` на `postgresql+asyncpg://`

**Пример:**
```
Было:  postgresql://postgres:password@containers-us-west-123.railway.app:5432/railway
Нужно: postgresql+asyncpg://postgres:password@containers-us-west-123.railway.app:5432/railway
```

#### Шаг 3: Добавьте в Railway

1. В разделе Variables вашего сервиса приложения
2. Поле **VARIABLE_NAME**: `DATABASE_URL`
3. Поле **VALUE**: вставьте измененное значение (с `postgresql+asyncpg://`)
4. Нажмите **Add**

---

### Переменная 2: OPENAI_API_KEY

#### Шаг 1: Получите ваш реальный ключ

У вас должен быть ключ от ProxyAPI. Если нет, получите его на [proxyapi.ru](https://proxyapi.ru)

#### Шаг 2: Добавьте в Railway

1. Поле **VARIABLE_NAME**: `OPENAI_API_KEY`
2. Поле **VALUE**: ваш реальный ключ (например: `sk-tsnn3jx66aPvVtcGGte3MxRJ35DT8Uyz`)
3. Нажмите **Add**

**⚠️ ВАЖНО:** Используйте ваш реальный ключ, не примеры!

---

### Переменная 3: SECRET_KEY

#### Шаг 1: Сгенерируйте случайную строку

Нужна случайная строка минимум 32 символа. Можно использовать:

**Вариант 1: Онлайн генератор**
- Зайдите на [random.org](https://www.random.org/strings/)
- Сгенерируйте строку из 32+ символов

**Вариант 2: Через терминал**
```bash
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

**Вариант 3: Использовать готовую (для теста)**
```
dev-secret-key-change-in-production-use-random-string-here
```

#### Шаг 2: Добавьте в Railway

1. Поле **VARIABLE_NAME**: `SECRET_KEY`
2. Поле **VALUE**: ваша случайная строка (минимум 32 символа)
3. Нажмите **Add**

---

## 🎯 Визуальная инструкция заполнения

### Пример заполнения поля DATABASE_URL:

```
┌─────────────────────────────────────────┐
│ VARIABLE_NAME                           │
│ ┌─────────────────────────────────────┐ │
│ │ DATABASE_URL                        │ │ ← Введите имя переменной
│ └─────────────────────────────────────┘ │
│                                         │
│ VALUE or ${{REF}}                       │
│ ┌─────────────────────────────────────┐ │
│ │ postgresql+asyncpg://postgres:pass  │ │ ← Вставьте значение
│ │ @host:5432/railway                  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [Add] [Cancel]                          │
└─────────────────────────────────────────┘
```

### Пример заполнения поля OPENAI_API_KEY:

```
┌─────────────────────────────────────────┐
│ VARIABLE_NAME                           │
│ ┌─────────────────────────────────────┐ │
│ │ OPENAI_API_KEY                      │ │ ← Введите имя переменной
│ └─────────────────────────────────────┘ │
│                                         │
│ VALUE or ${{REF}}                       │
│ ┌─────────────────────────────────────┐ │
│ │ sk-tsnn3jx66aPvVtcGGte3MxRJ35DT8Uyz │ │ ← Ваш реальный ключ
│ └─────────────────────────────────────┘ │
│                                         │
│ [Add] [Cancel]                          │
└─────────────────────────────────────────┘
```

### Пример заполнения поля SECRET_KEY:

```
┌─────────────────────────────────────────┐
│ VARIABLE_NAME                           │
│ ┌─────────────────────────────────────┐ │
│ │ SECRET_KEY                         │ │ ← Введите имя переменной
│ └─────────────────────────────────────┘ │
│                                         │
│ VALUE or ${{REF}}                       │
│ ┌─────────────────────────────────────┐ │
│ │ dev-secret-key-change-in-productio │ │ ← Случайная строка 32+ символов
│ │ n-use-random-string-here            │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [Add] [Cancel]                          │
└─────────────────────────────────────────┘
```

---

## ✅ Чеклист

После добавления всех переменных проверьте:

- [ ] `DATABASE_URL` добавлен (формат `postgresql+asyncpg://`)
- [ ] `OPENAI_API_KEY` добавлен (ваш реальный ключ)
- [ ] `SECRET_KEY` добавлен (минимум 32 символа)
- [ ] Все переменные видны в списке Variables
- [ ] Railway автоматически перезапустил сервис
- [ ] В логах нет ошибки `ValidationError`

---

## 🔍 Где взять значения

### DATABASE_URL

**Источник:** Railway → Сервис PostgreSQL → Variables → `DATABASE_URL` или `POSTGRES_URL`

**Формат:** `postgresql+asyncpg://postgres:PASSWORD@HOST:PORT/railway`

**Пример:**
```
postgresql+asyncpg://postgres:abc123@containers-us-west-123.railway.app:5432/railway
```

### OPENAI_API_KEY

**Источник:** Ваш аккаунт на [proxyapi.ru](https://proxyapi.ru) или локальный файл `.env`

**Формат:** `sk-...` (начинается с `sk-`)

**Пример:**
```
sk-tsnn3jx66aPvVtcGGte3MxRJ35DT8Uyz
```

### SECRET_KEY

**Источник:** Сгенерируйте случайную строку

**Формат:** Любая строка минимум 32 символа

**Пример:**
```
dev-secret-key-change-in-production-use-random-string-here
```

---

## ⚠️ Важные моменты

1. **Имена переменных** - используйте ЗАГЛАВНЫЕ БУКВЫ:
   - ✅ `DATABASE_URL`
   - ✅ `OPENAI_API_KEY`
   - ✅ `SECRET_KEY`
   - ❌ `database_url` (не рекомендуется)

2. **DATABASE_URL формат** - обязательно `postgresql+asyncpg://`:
   - ✅ `postgresql+asyncpg://...`
   - ❌ `postgresql://...` (неправильно!)

3. **OPENAI_API_KEY** - используйте реальный ключ:
   - ✅ Ваш реальный ключ от ProxyAPI
   - ❌ `sk-XXXXX` или примеры

4. **SECRET_KEY** - минимум 32 символа:
   - ✅ 32+ символов
   - ❌ Меньше 32 символов

---

## 🚀 После добавления

После добавления всех 3 переменных:

1. Railway автоматически перезапустит сервис
2. Подождите 1-2 минуты
3. Проверьте Deploy Logs - ошибка `ValidationError` должна исчезнуть
4. Приложение должно успешно запуститься

---

## 📞 Если что-то не работает

1. Проверьте формат DATABASE_URL (`postgresql+asyncpg://`)
2. Проверьте, что используете реальный OPENAI_API_KEY
3. Проверьте длину SECRET_KEY (минимум 32 символа)
4. Убедитесь, что переменные добавлены в сервис ПРИЛОЖЕНИЯ, а не PostgreSQL
5. Перезапустите сервис вручную: Settings → Restart Service

---

**Готово! После добавления всех переменных приложение должно запуститься!** 🎉

