# üîå –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CRM

**–î–∞—Ç–∞:** 2025-11-27

---

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–∞—à–µ–π CRM —Å–∏—Å—Ç–µ–º–æ–π. API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π REST endpoint –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö —Å –ø–æ–º–æ—â—å—é –ò–ò.

---

## üîó API Endpoint

### –ë–∞–∑–æ–≤—ã–π URL
```
https://ai-automating-customer-messages-production.up.railway.app
```

### Endpoint –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
```
POST /api/messages/
```

---

## üì§ –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

### Headers
```
Content-Type: application/json
X-Webhook-URL: https://your-crm.com/webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
X-Idempotency-Key: unique-key-123 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### Body
```json
{
  "client_id": "client_123",
  "content": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞",
  "timestamp": "2025-11-27T12:00:00Z" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `client_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ
- `content` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (–º–∞–∫—Å. 5000 —Å–∏–º–≤–æ–ª–æ–≤)
- `timestamp` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è)

---

## üì• –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200 OK)
```json
{
  "status": "success",
  "original_message_id": "uuid",
  "is_first_message": true,
  "priority": "low",
  "escalation_reason": null,
  "classification": {
    "scenario": "GREETING",
    "confidence": 0.92,
    "id": "uuid",
    "reasoning": "–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∑–∞ –ø–æ–º–æ—â—å—é..."
  },
  "response": {
    "message_id": "uuid",
    "text": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã –†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å...",
    "type": "bot_auto"
  },
  "webhook": {
    "success": true,
    "error": null
  }
}

```

### –û—à–∏–±–∫–∏
- `400 Bad Request` - –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
- `429 Too Many Requests` - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞)
- `500 Internal Server Error` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## üîÑ Webhook –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤

–ï—Å–ª–∏ –≤—ã —É–∫–∞–∑–∞–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Webhook-URL`, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –æ—Ç–≤–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –≤–∞—à—É CRM —Å–∏—Å—Ç–µ–º—É.

### –§–æ—Ä–º–∞—Ç webhook –∑–∞–ø—Ä–æ—Å–∞
```
POST {your-webhook-url}
Content-Type: application/json
```

```json
{
  "client_id": "client_123",
  "response_text": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã –†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å...",
  "message_id": "uuid",
  "classification": {
    "scenario": "GREETING",
    "confidence": 0.92
  }
}
```

**–í–∞–∂–Ω–æ:** Webhook –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –ï—Å–ª–∏ webhook –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –¥–æ 5 —Ä–∞–∑ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.

---

## üìä –°—Ü–µ–Ω–∞—Ä–∏–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —Å–ª–µ–¥—É—é—â–∏–º —Å—Ü–µ–Ω–∞—Ä–∏—è–º:

- **GREETING** - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –ø–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ
- **REFERRAL** - –í–æ–ø—Ä–æ—Å—ã –æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
- **TECH_SUPPORT_BASIC** - –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- **FAREWELL** - –ü—Ä–æ—â–∞–Ω–∏–µ
- **REMINDER** - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- **ABSENCE_REQUEST** - –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ
- **SCHEDULE_CHANGE** - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- **COMPLAINT** - –ñ–∞–ª–æ–±—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç—Å–∫–∞–ª–∏—Ä—É—é—Ç—Å—è)
- **MISSING_TRAINER** - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–Ω–µ—Ä–∞
- **MASS_OUTAGE** - –ú–∞—Å—Å–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- **REVIEW_BONUS** - –í–æ–ø—Ä–æ—Å—ã –æ –±–æ–Ω—É—Å–∞—Ö –∑–∞ –æ—Ç–∑—ã–≤—ã
- **CROSS_EXTENSION** - –ö—Ä–æ—Å—Å-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ
- **UNKNOWN** - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (—Ç—Ä–µ–±—É–µ—Ç —ç—Å–∫–∞–ª–∞—Ü–∏–∏)

---

## ‚öôÔ∏è –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ —ç—Å–∫–∞–ª–∞—Ü–∏—è

–°–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤:

- **low** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –ò–ò
- **medium** - –ó–∞–ø—Ä–æ—Å—ã —Å–æ —Å—Ä–µ–¥–Ω–µ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –∏–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- **high** - –ñ–∞–ª–æ–±—ã, –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã, –Ω–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ò–ò
- **critical** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –º–∞—Å—Å–æ–≤—ã–µ —Å–±–æ–∏

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —ç—Å–∫–∞–ª–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏:**
- –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ò–ò < 0.7
- –°—Ü–µ–Ω–∞—Ä–∏–π = COMPLAINT
- –°—Ü–µ–Ω–∞—Ä–∏–π = UNKNOWN
- 3+ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∑–∞ 10 –º–∏–Ω—É—Ç
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –º–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### Rate Limiting
- **–ù–∞ IP –∞–¥—Ä–µ—Å:** 60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É, 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
- **–ù–∞ –∫–ª–∏–µ–Ω—Ç–∞:** 10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É

### Idempotency
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Idempotency-Key` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤. –°–∏—Å—Ç–µ–º–∞ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥.

### CORS
API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –Ω–∞ Vercel. –î–ª—è –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–æ–≤ –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ALLOWED_ORIGINS` –≤ Railway.

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### cURL
```bash
curl -X POST https://ai-automating-customer-messages-production.up.railway.app/api/messages/ \
  -H "Content-Type: application/json" \
  -H "X-Webhook-URL: https://your-crm.com/webhook" \
  -d '{
    "client_id": "client_123",
    "content": "–ü—Ä–∏–≤–µ—Ç! –•–æ—á—É —É–∑–Ω–∞—Ç—å –ø—Ä–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É"
  }'
```

### Python
```python
import requests

url = "https://ai-automating-customer-messages-production.up.railway.app/api/messages/"
headers = {
    "Content-Type": "application/json",
    "X-Webhook-URL": "https://your-crm.com/webhook"
}
data = {
    "client_id": "client_123",
    "content": "–ü—Ä–∏–≤–µ—Ç! –•–æ—á—É —É–∑–Ω–∞—Ç—å –ø—Ä–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É"
}

response = requests.post(url, json=data, headers=headers)
print(response.json())
```

### JavaScript/Node.js
```javascript
const response = await fetch(
  'https://ai-automating-customer-messages-production.up.railway.app/api/messages/',
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-Webhook-URL': 'https://your-crm.com/webhook'
    },
    body: JSON.stringify({
      client_id: 'client_123',
      content: '–ü—Ä–∏–≤–µ—Ç! –•–æ—á—É —É–∑–Ω–∞—Ç—å –ø—Ä–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É'
    })
  }
);

const data = await response.json();
console.log(data);
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- [ ] –ü–æ–ª—É—á–µ–Ω API URL –æ—Ç Railway
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω webhook URL –≤ –≤–∞—à–µ–π CRM —Å–∏—Å—Ç–µ–º–µ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Webhook-URL` –≤ –∑–∞–ø—Ä–æ—Å—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç API
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway Dashboard
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã rate limiting
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook URL

---

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏!** üöÄ

